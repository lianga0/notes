# C语言的表达式求值顺序问题？

> 薛非的回答

> [C语言的表达式求值顺序问题？](https://www.zhihu.com/question/35595415/answer/63598928)

一个表达式中既可以包括相同类型的运算符，也可以包括不同类型的运算符或者函数。当多种运算符出现在同一个表达式中时，应该先按照不同类型运算符间的优先级进行结合运算。但优先级与求值顺序无关。

表达式的结合次序取决于表达式中各种运算符的优先级。优先级高的运算符先结合，优先级低的运算符后结合，同一行中的运算符的优先级相同。

## 优先级与求值顺序无关。如`a+b && b*c`，虽然`*`优先级最高，但这个表达式求值顺序是从左到右。

C语言中相同优先级中，按结合性进行结合。大多数运算符结合性是从左到右，只有三个优先级是从右至左结合的，它们是单目运算符、条件运算符、赋值运算符。

> [运算符优先级](https://baike.baidu.com/item/%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7/4752611?fr=aladdin)

例如如下C程序

```
#include <stdio.h>

int f(int a)
{
    printf("%d\n", a);
    return a;
}

int main(void)
{
    printf("f(1)+f(2)*f(3)=%d\n", f(1) + f(2) * f(3));
    printf("f(1)+(f(2)*f(3))=%d\n", f(1) + (f(2) * f(3)));
    return 0;
}
```

它的输出为：

```
1
2
3
f(1)+f(2)*f(3)=7
1
2
3
f(1)+(f(2)*f(3))=7
```

## 优先级和求值次序

优先级和求值次序是两回事。

优先级规定的是运算符的对象，

就你举的例子而言，

按照优先级，

```y！=0 &&  x/y > tolerance```的意义是，

表达式等价于`y！=0 &&  (x/y) > tolerance`

即 `x` 和 `y` 是运算符 `/` 的运算对象，但不意味着这个运算一定先进行。

进一步分析，表达式等价于 `y！=0 && ((x/y) > tolerance)`

 即 `>` 的运算对象是 `(x/y)` 和 `tolerance`。

再下面优先级最高的是 `!=`，即 `(y！=0) && ((x/y) > tolerance)`

它告诉你的或者向编译器表明的是 `y` 和 `0` 做 `!=` 运算，因此 `&&` 的运算对象是 `(y！=0)`和`((x/y) > tolerance)`。

但是`&&`这个运算要求一定要先求左边运算对象的值因此先求`(y！=0)`的值，一旦这个值为`0`（即`y==0`的情况），就不再求`&&`右面的值了，直接得到整个表达式的值——`0`。

总之，谁告诉你优先级就是“先乘除后加减”（没猜错的话应该是老谭），给你造成了优先级高就是先运算这个错觉的。

> 简单的总结：

> 优先级和求值的先后顺序，确实是两回事。打个比方，优先级好像古文里面的断句法，决定了何处，实际上等于加上了括号。但断句怎么断，不都是还要从左向右(或者从右向左)阅读句子么？阅读的顺序不受到断句法的影响的。

Reference:

[C语言的表达式求值顺序问题？](https://www.zhihu.com/question/35595415)

